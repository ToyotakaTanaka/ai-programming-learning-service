# お問合せ機能 動作確認チェックリスト

## 概要
- **対象機能**: お問合せフォーム機能
- **対象URL**: `/contact`
- **API**: `/api/contact`
- **作成日**: 2025年12月15日

---

## 1. お問合せフォーム画面の表示

### 確認項目
| # | 確認内容 | 期待結果 | 結果 | 備考 |
|---|---------|---------|------|------|
| 1-1 | `/contact` にアクセスする | お問合せフォーム画面が表示される | ☐ | |
| 1-2 | 「お名前」入力欄が表示される | TextField が表示され、入力可能 | ☐ | |
| 1-3 | 「メールアドレス」入力欄が表示される | TextField が表示され、入力可能 | ☐ | |
| 1-4 | 「件名」入力欄が表示される | TextField が表示され、入力可能 | ☐ | |
| 1-5 | 「メッセージ」入力欄が表示される | 複数行 TextField が表示され、入力可能 | ☐ | |
| 1-6 | 「送信する」ボタンが表示される | Button が表示される | ☐ | |
| 1-7 | レスポンシブ対応（モバイル表示） | スマホサイズでも崩れずに表示される | ☐ | |

---

## 2. 必須項目の未入力時エラー表示

### 確認項目
| # | 確認内容 | 期待結果 | 結果 | 備考 |
|---|---------|---------|------|------|
| 2-1 | 全項目を空のまま送信ボタンを押す | 「お名前を入力してください」エラーが表示される | ☐ | |
| 2-2 | お名前のみ入力して送信 | 「メールアドレスを入力してください」エラーが表示される | ☐ | |
| 2-3 | お名前・メールのみ入力して送信 | 「件名を入力してください」エラーが表示される | ☐ | |
| 2-4 | お名前・メール・件名のみ入力して送信 | 「メッセージを入力してください」エラーが表示される | ☐ | |
| 2-5 | エラー表示後、該当項目に入力するとエラーが消える | リアルタイムでエラーメッセージが消える | ☐ | |

---

## 3. メールアドレス形式エラー表示

### 確認項目
| # | 確認内容 | 期待結果 | 結果 | 備考 |
|---|---------|---------|------|------|
| 3-1 | メールアドレス欄に「test」と入力 | 「有効なメールアドレスを入力してください」エラー表示 | ☐ | |
| 3-2 | メールアドレス欄に「test@」と入力 | 「有効なメールアドレスを入力してください」エラー表示 | ☐ | |
| 3-3 | メールアドレス欄に「test@example」と入力 | 「有効なメールアドレスを入力してください」エラー表示 | ☐ | |
| 3-4 | メールアドレス欄に「test@example.com」と入力 | エラーが表示されない（正常） | ☐ | |
| 3-5 | メールアドレス欄に「user.name+tag@example.co.jp」と入力 | エラーが表示されない（正常） | ☐ | |

---

## 4. 送信成功時の完了画面表示

### 確認項目
| # | 確認内容 | 期待結果 | 結果 | 備考 |
|---|---------|---------|------|------|
| 4-1 | 全項目を正しく入力して送信ボタンを押す | 送信中のローディング表示（ボタンが disabled） | ☐ | |
| 4-2 | 送信処理完了 | 「送信完了」画面が表示される | ☐ | |
| 4-3 | 完了画面に感謝メッセージが表示される | 「お問合せありがとうございます」等のメッセージ | ☐ | |
| 4-4 | 「お問合せフォームに戻る」ボタンが表示される | ボタンが表示される | ☐ | |
| 4-5 | 「お問合せフォームに戻る」ボタンを押す | フォーム画面に戻り、入力欄がクリアされている | ☐ | |

---

## 5. 管理者へのメール受信確認

### 前提条件
- `.env.local` に正しいメール設定がされていること
- Gmailの場合、アプリパスワードが設定されていること

### 確認項目
| # | 確認内容 | 期待結果 | 結果 | 備考 |
|---|---------|---------|------|------|
| 5-1 | お問合せ送信後、管理者メールを確認 | 「[お問合せ] {件名}」のメールが届く | ☐ | |
| 5-2 | メール本文に「名前」が含まれる | 入力した名前が表示される | ☐ | |
| 5-3 | メール本文に「メールアドレス」が含まれる | 入力したメールアドレスが表示される | ☐ | |
| 5-4 | メール本文に「件名」が含まれる | 入力した件名が表示される | ☐ | |
| 5-5 | メール本文に「メッセージ」が含まれる | 入力したメッセージが表示される | ☐ | |
| 5-6 | メールの返信先（Reply-To）が送信者のアドレス | 返信ボタンで送信者に返信できる | ☐ | |

---

## 6. MongoDBへのデータ保存確認

### 前提条件
- MongoDBが起動していること
- `.env.local` に正しい `MONGODB_URI` が設定されていること

### 確認項目
| # | 確認内容 | 期待結果 | 結果 | 備考 |
|---|---------|---------|------|------|
| 6-1 | お問合せ送信後、MongoDBを確認 | `contacts` コレクションにドキュメントが追加される | ☐ | |
| 6-2 | 保存データに `name` フィールドがある | 入力した名前が保存されている | ☐ | |
| 6-3 | 保存データに `email` フィールドがある | 入力したメールアドレスが保存されている | ☐ | |
| 6-4 | 保存データに `subject` フィールドがある | 入力した件名が保存されている | ☐ | |
| 6-5 | 保存データに `message` フィールドがある | 入力したメッセージが保存されている | ☐ | |
| 6-6 | 保存データに `createdAt` フィールドがある | 送信日時が自動設定されている | ☐ | |
| 6-7 | 保存データに `status` フィールドがある | デフォルト値「unread」が設定されている | ☐ | |

### MongoDB確認コマンド（参考）
```bash
# MongoDB Shellで確認
mongosh
use survibeai
db.contacts.find().pretty()
```

---

## 7. エラーハンドリング確認

### 確認項目
| # | 確認内容 | 期待結果 | 結果 | 備考 |
|---|---------|---------|------|------|
| 7-1 | MongoDB停止中に送信 | エラーメッセージが表示される | ☐ | |
| 7-2 | ネットワークエラー時 | エラーメッセージが表示される | ☐ | |
| 7-3 | メール送信失敗時 | DBには保存され、ログにエラーが出力される | ☐ | |

---

## 8. セキュリティ確認

### 確認項目
| # | 確認内容 | 期待結果 | 結果 | 備考 |
|---|---------|---------|------|------|
| 8-1 | XSS攻撃文字列を入力（`<script>alert('XSS')</script>`） | スクリプトが実行されずにサニタイズされる | ☐ | |
| 8-2 | HTMLタグを入力（`<b>太字</b>`） | タグが除去またはエスケープされる | ☐ | |
| 8-3 | GET リクエストを `/api/contact` に送信 | 405 Method Not Allowed が返る | ☐ | |

---

## テスト実施記録

| 実施日 | 実施者 | 結果 | 備考 |
|--------|--------|------|------|
| | | | |

---

## 備考
- メール送信機能はGmailのアプリパスワード設定が必要
- MongoDBはローカルまたはMongoDB Atlasを使用
- 本番環境では環境変数の適切な設定を確認すること
